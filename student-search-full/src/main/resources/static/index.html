<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Student Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: Arial, sans-serif; background:#f6f7fb; margin:0; padding:40px; }
    .card { max-width: 960px; margin: 0 auto; background: #fff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.05); padding: 24px; }
    h1 { margin: 0 0 8px; font-size: 24px; }
    p.sub { color:#666; margin-top:0; }
    .row { display: flex; gap: 12px; margin: 16px 0 24px; }
    input[type=text] { flex: 1; padding: 12px 14px; border:1px solid #e5e7eb; border-radius: 10px; font-size: 16px; outline: none; }
    button { padding: 12px 16px; border:0; border-radius: 10px; background:#2563eb; color:#fff; font-weight:600; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    table { width:100%; border-collapse: collapse; }
    th, td { padding: 10px 12px; border-bottom:1px solid #eee; text-align: left; }
    th { background:#fafafa; }
    .muted { color:#777; }
    .results { max-height: 540px; overflow:auto; border:1px solid #eee; border-radius: 10px; }
    .chips { display:flex; gap:8px; flex-wrap: wrap; }
    .chip { background:#eef2ff; color:#3730a3; padding:6px 10px; border-radius: 999px; cursor:pointer; border:1px solid #e0e7ff; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Student Search</h1>
    <p class="sub">Type a name (partial or full) and press Enter. Uses case-insensitive search.</p>
    <div class="row">
      <input id="q" type="text" placeholder="e.g. Grace, Cha, Bob" />
      <button id="btn">Search</button>
    </div>
    <div class="chips">
      <span class="chip" data-q="Gra">Gra</span>
      <span class="chip" data-q="Cha">Cha</span>
      <span class="chip" data-q="Bob">Bob</span>
    </div>
    <div id="status" class="muted" style="margin: 10px 0 14px;"></div>
    <div class="results">
      <table>
        <thead>
          <tr><th>ID</th><th>Name</th><th>Age</th><th>Class</th><th>Grade</th></tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="5" class="muted">No results yet. Try a query above.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

<script>
const q = document.getElementById('q');
const btn = document.getElementById('btn');
const tbody = document.getElementById('tbody');
const statusEl = document.getElementById('status');

async function search() {
  const query = q.value.trim();
  if (!query) return;
  btn.disabled = true;
  statusEl.textContent = 'Searchingâ€¦';
  try {
    const res = await fetch(`/api/students/search/contains?q=${encodeURIComponent(query)}`);
    const data = await res.json();
    renderRows(data);
    statusEl.textContent = `Found ${data.length} result(s)`;
  } catch (e) {
    statusEl.textContent = 'Error fetching results';
  } finally {
    btn.disabled = false;
  }
}

function renderRows(rows) {
  tbody.innerHTML = '';
  if (!rows || rows.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" class="muted">No matches.</td></tr>';
    return;
  }
  for (const r of rows) {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.name}</td><td>${r.age ?? ''}</td><td>${r.className ?? ''}</td><td>${r.grade ?? ''}</td>`;
    tbody.appendChild(tr);
  }
}

btn.addEventListener('click', search);
q.addEventListener('keydown', (e) => { if (e.key === 'Enter') search(); });
document.querySelectorAll('.chip').forEach(c => c.addEventListener('click', () => { q.value = c.dataset.q; search(); }));
</script>
</body>
</html>
